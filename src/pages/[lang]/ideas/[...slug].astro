---
import { type CollectionEntry, getCollection } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { languages } from '../../../i18n/ui';

export async function getStaticPaths() {
	const posts = await getCollection('ideas');
	const paths = [];
	
	// Filter for non-English posts
	const nonEnPosts = posts.filter(post => !post.slug.startsWith('en/'));

	for (const post of nonEnPosts) {
		const [lang, ...slugParts] = post.slug.split('/');
		if (lang in languages && lang !== 'en') {
			paths.push({
				params: { lang, slug: slugParts.join('/') },
				props: post,
			});
		}
	}
	return paths;
}
type Props = CollectionEntry<'ideas'>;

const post = Astro.props;
const { Content } = await post.render();
---

<BaseLayout title={post.data.title} description={post.data.description}>
	<article class="blog-post">
		<header>
			<div class="meta">
				<time datetime={post.data.pubDate.toISOString()}>
					{post.data.pubDate.toLocaleDateString('zh-CN', {
						year: 'numeric',
						month: 'long',
						day: 'numeric',
					})}
				</time>
				{post.data.tags && (
					<span class="tags">
						{post.data.tags.map(tag => `#${tag}`).join(' ')}
					</span>
				)}
			</div>
			<h1>{post.data.title}</h1>
			<p class="description">{post.data.description}</p>
		</header>
		<div class="content">
			<Content />
		</div>
	</article>
</BaseLayout>

<style>
	.blog-post {
		max-width: 720px;
		margin: 0 auto;
	}

	header {
		margin-bottom: 3rem;
		text-align: center;
		padding-bottom: 2rem;
		border-bottom: 1px solid var(--color-border);
	}

	.meta {
		color: var(--color-primary);
		opacity: 0.7;
		margin-bottom: 1rem;
		display: flex;
		justify-content: center;
		gap: 1rem;
	}

	h1 {
		font-size: 2.5rem;
		margin-bottom: 1rem;
	}

	.description {
		font-size: 1.2rem;
		opacity: 0.9;
	}

	.content {
		line-height: 1.8;
		font-size: 1.1rem;
	}

	/* Markdown Content Styles */
	.content :global(h2) {
		margin-top: 2.5rem;
		font-size: 1.8rem;
	}

	.content :global(h3) {
		margin-top: 2rem;
		font-size: 1.4rem;
	}

	.content :global(p) {
		margin-bottom: 1.5rem;
	}

	.content :global(ul), .content :global(ol) {
		margin-bottom: 1.5rem;
		padding-left: 1.5rem;
	}

	.content :global(li) {
		margin-bottom: 0.5rem;
	}

	.content :global(blockquote) {
		border-left: 4px solid var(--color-accent);
		padding-left: 1rem;
		margin: 1.5rem 0;
		font-style: italic;
		color: var(--color-primary);
	}

	.content :global(pre) {
		padding: 1rem;
		border-radius: 8px;
		background-color: var(--color-bg-code);
		overflow-x: auto;
		margin-bottom: 1.5rem;
	}

	.content :global(code) {
		font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
		font-size: 0.9em;
	}
</style>
